{"version":3,"sources":["utils.ts"],"names":["SerializerSelfRefIdentifier","SerializerRefIdentifier","ClassConstructorPlaceholder","RefPlaceholder","EmptyPlaceholder","Symbol","partialResult","constructor","node","factory","value","createEmpty","updateInstance","SerializerError","final","finalInstance","fromPlain","__value","ref","isSerializerNode","data","R","isPlainObject","hasProp","isRootNode","extractClassName","registry","Map","register","name","has","set","target","get","index","indexOf","push","filter","Boolean","join","isObjectType","isFunction","Function","primitiveToSerializableClass","ClassByValueType","string","String","number","Number","bigint","BigInt","boolean","symbol","undefined","Undefined","null","Null","object","Object","function","type","traverseObject","obj","handler","stopFn","seen","SafeWeakSet","traverse","_obj","path","add","key","entries","concat","isSerializationRequired","primitive","includes","traverseWithUpdate","Array","isArray","idx","update","newValue","Set","values","delete","shallowCopy","assign","slice","isDirectInstanceOf","Date","deepCopy","source","clone","copy","result","setProp","toBoundedFunction","fn","binds","getFunctionBinds","getProp"],"mappings":"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","file":"utils.js","sourcesContent":["/**\n * Copyright 2025 Â© BeeAI a Series of LF Projects, LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport * as R from \"remeda\";\nimport { SafeWeakSet } from \"@/internals/helpers/weakRef.js\";\nimport { AnyConstructable, AnyFn, ClassConstructor, NamedFunction } from \"@/internals/types.js\";\nimport { SerializeFactory } from \"@/serializer/serializer.js\";\nimport { getProp, hasProp, setProp } from \"@/internals/helpers/object.js\";\nimport { isDirectInstanceOf } from \"@/internals/helpers/prototype.js\";\nimport { SerializerError } from \"@/serializer/error.js\";\nimport { isFunction, isObjectType } from \"remeda\";\n\nexport const SerializerSelfRefIdentifier = \"__self_ref\";\nexport const SerializerRefIdentifier = \"__ref\";\nexport class ClassConstructorPlaceholder {}\nexport class RefPlaceholder<T = unknown> {\n  private static EmptyPlaceholder = Symbol();\n  private partialResult: T = RefPlaceholder.EmptyPlaceholder as T;\n\n  constructor(\n    protected readonly node: SerializerNode,\n    protected readonly factory: SerializeFactory<T>,\n  ) {}\n\n  get value() {\n    if (this.partialResult !== RefPlaceholder.EmptyPlaceholder) {\n      return this.partialResult;\n    }\n\n    const { createEmpty, updateInstance } = this.factory;\n    if (!createEmpty || !updateInstance) {\n      throw new SerializerError(\"Circular dependency has been detected!\");\n    }\n\n    this.partialResult = createEmpty();\n    return this.partialResult;\n  }\n\n  async final() {\n    const finalInstance = await this.factory.fromPlain(this.node.__value, this.factory.ref);\n    if (this.partialResult === RefPlaceholder.EmptyPlaceholder) {\n      return finalInstance;\n    }\n\n    await this.factory.updateInstance!(this.partialResult, finalInstance);\n    return this.partialResult;\n  }\n}\n\nexport interface SerializerNode {\n  __class: string;\n  __ref: string;\n  __value: unknown;\n  __serializer: true;\n}\nexport function isSerializerNode(data: unknown): data is SerializerNode {\n  return R.isPlainObject(data) && hasProp(data as unknown as SerializerNode, \"__serializer\");\n}\n\nexport interface RootNode<T = any> {\n  __version: string;\n  __root: T;\n}\n\nexport function isRootNode<T>(data: unknown): data is RootNode<T> {\n  return (\n    R.isPlainObject(data) &&\n    hasProp(data as unknown as RootNode<T>, \"__root\") &&\n    hasProp(data as unknown as RootNode<T>, \"__version\")\n  );\n}\n\nexport const extractClassName = (() => {\n  const registry = new Map<string, unknown[]>();\n  const register = (name: string, factory: any) => {\n    if (!registry.has(name)) {\n      registry.set(name, []);\n    }\n    const target = registry.get(name)!;\n    let index = target.indexOf(factory);\n    if (index === -1) {\n      index = target.push(factory) - 1;\n    }\n    return [name, index].filter(Boolean).join(\"\");\n  };\n\n  return (value: unknown): string => {\n    if (R.isObjectType(value) && \"constructor\" in value) {\n      const name = value.constructor.name;\n      return register(name, value.constructor);\n    }\n    if (R.isFunction(value)) {\n      const name = value.name || value.constructor?.name || Function.name;\n      return register(name, value);\n    }\n    return extractClassName(primitiveToSerializableClass(value));\n  };\n})();\n\nconst ClassByValueType = {\n  string: String,\n  number: Number,\n  bigint: BigInt,\n  boolean: Boolean,\n  symbol: Symbol,\n  undefined: class Undefined {},\n  null: class Null {},\n  object: Object,\n  function: Function,\n} as const;\n\nexport function primitiveToSerializableClass(value: unknown) {\n  const type = value === null ? \"null\" : typeof value;\n  return ClassByValueType[type];\n}\n\ntype TraverseObjectFn = (el: { key: string; path: readonly string[]; value: any }) => Promise<void>;\nexport async function traverseObject(\n  obj: unknown,\n  handler: TraverseObjectFn,\n  stopFn?: (_obj: unknown) => boolean,\n) {\n  const seen = new SafeWeakSet();\n\n  const traverse = async (_obj: unknown, path: readonly string[] = []) => {\n    if (!R.isPlainObject(_obj) || seen.has(_obj)) {\n      return;\n    }\n    seen.add(_obj);\n\n    if (stopFn?.(_obj)) {\n      return;\n    }\n\n    for (const [key, value] of Object.entries(_obj)) {\n      await traverse(value, path.concat(key));\n      await handler({\n        key,\n        value,\n        path: path.concat(key),\n      });\n    }\n  };\n\n  return await traverse(obj, []);\n}\n\nexport function isSerializationRequired(factory: ClassConstructor | NamedFunction) {\n  const primitive: unknown[] = [ClassByValueType.string, ClassByValueType.boolean];\n  return !primitive.includes(factory);\n}\n\nexport function* traverseWithUpdate<T = unknown>(\n  _obj: unknown,\n): Generator<{ value: T; update: (value: T) => void }> {\n  if (Array.isArray(_obj)) {\n    for (const [idx, value] of _obj.entries()) {\n      yield {\n        value,\n        update: (newValue) => {\n          _obj[idx] = newValue;\n        },\n      };\n    }\n  } else if (R.isPlainObject(_obj)) {\n    for (const [key, value] of R.entries(_obj)) {\n      yield {\n        value: value as T,\n        update: (newValue) => {\n          _obj[key] = newValue;\n        },\n      };\n    }\n  } else if (_obj instanceof Map) {\n    for (const [key, value] of _obj.entries()) {\n      yield {\n        value,\n        update: (newValue) => {\n          _obj.set(key, newValue);\n        },\n      };\n    }\n  } else if (_obj instanceof Set) {\n    for (const value of _obj.values()) {\n      yield {\n        value,\n        update: (newValue) => {\n          _obj.delete(value);\n          _obj.add(newValue);\n        },\n      };\n    }\n  }\n}\n\nexport function shallowCopy<T>(value: T): T {\n  if (R.isPlainObject(value)) {\n    return Object.assign({}, value);\n  } else if (R.isArray(value)) {\n    return value.slice() as T;\n  } else if (isDirectInstanceOf(value, Map)) {\n    return new Map(value.entries()) as T;\n  } else if (isDirectInstanceOf(value, Set)) {\n    return new Set(value.values()) as T;\n  } else if (isDirectInstanceOf(value, Date)) {\n    return new Date(value) as T;\n  }\n  return value;\n}\n\nexport async function deepCopy<T>(source: T): Promise<T> {\n  if (isObjectType(source) && \"clone\" in source && isFunction(source.clone)) {\n    return await source.clone();\n  }\n  const copy = shallowCopy(source);\n  await traverseObject(source, async ({ value, path }) => {\n    const result = await deepCopy(value);\n    setProp(copy, path, result);\n  });\n  return copy;\n}\n\ntype Bounded =\n  | {\n      name: string;\n      value: any;\n    }\n  | AnyConstructable;\n\nexport function toBoundedFunction<T extends AnyFn>(fn: T, binds: [Bounded, ...Bounded[]]) {\n  Object.assign(fn, { [toBoundedFunction.symbol]: binds });\n  return fn;\n}\ntoBoundedFunction.symbol = Symbol(\"bounded\");\n\n// eslint-disable-next-line @typescript-eslint/no-unsafe-function-type\nexport function getFunctionBinds<T extends Function>(fn: T) {\n  const target = getProp(fn, [toBoundedFunction.symbol], []);\n  return target as Bounded[];\n}\n"]}