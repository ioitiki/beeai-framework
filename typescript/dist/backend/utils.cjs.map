{"version":3,"sources":["utils.ts"],"names":["findProviderDef","value","Object","values","BackendProviders","find","p","name","module","aliases","includes","parseModel","ValueError","providerId","rest","split","modelId","join","providerDef","loadModel","type","capitalize","generateToolUnionSchema","tools","isEmpty","schemas","Promise","all","map","tool","z","object","literal","parameters","inputSchema","hasMinLength","discriminatedUnion","filterToolsByToolChoice","Tool"],"mappings":"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","file":"utils.cjs","sourcesContent":["/**\n * Copyright 2025 Â© BeeAI a Series of LF Projects, LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { ValueError } from \"@/errors.js\";\nimport { ClassConstructor } from \"@/internals/types.js\";\nimport { BackendProviders, ProviderDef, ProviderName } from \"@/backend/constants.js\";\nimport { capitalize, isEmpty } from \"remeda\";\nimport { AnyTool, Tool } from \"@/tools/base.js\";\nimport { ChatModelToolChoice } from \"@/backend/chat.js\";\nimport { hasMinLength } from \"@/internals/helpers/array.js\";\nimport { z, ZodSchema } from \"zod\";\n\nexport type FullModelName = `${ProviderName}:${string}`;\n\nfunction findProviderDef(value: string): ProviderDef | null {\n  return (\n    Object.values(BackendProviders).find(\n      (p) => p.name === value || p.module === value || p.aliases.includes(value),\n    ) ?? null\n  );\n}\n\nexport function parseModel(name: string) {\n  if (!name) {\n    throw new ValueError(\"Neither 'provider' nor 'provider:model' was specified.\");\n  }\n  const [providerId, ...rest] = name.split(\":\") as [ProviderName, ...string[]];\n  const modelId = rest.join(\":\");\n\n  const providerDef = findProviderDef(providerId);\n  if (!providerDef) {\n    throw new ValueError(\"Model does not contain provider name!\");\n  }\n  return { providerId, modelId, providerDef };\n}\n\nexport async function loadModel<T>(\n  name: ProviderName | FullModelName,\n  type: \"embedding\" | \"chat\",\n): Promise<ClassConstructor<T>> {\n  const { providerDef } = parseModel(name);\n  const module = await import(`beeai-framework/adapters/${providerDef.module}/backend/${type}`);\n  return module[`${providerDef.name}${capitalize(type)}Model`];\n}\n\nexport async function generateToolUnionSchema(tools: AnyTool[]): Promise<ZodSchema> {\n  if (isEmpty(tools)) {\n    throw new ValueError(\"No tools provided!\");\n  }\n\n  const schemas = await Promise.all(\n    tools.map(async (tool) =>\n      z.object({\n        name: z.literal(tool.name),\n        parameters: (await tool.inputSchema()) as ZodSchema,\n      }),\n    ),\n  );\n\n  return hasMinLength(schemas, 2) ? z.discriminatedUnion(\"name\", schemas) : schemas[0];\n}\n\nexport function filterToolsByToolChoice(tools: AnyTool[], value?: ChatModelToolChoice): AnyTool[] {\n  if (value === \"none\") {\n    return [];\n  }\n\n  if (!value || value === \"required\" || value === \"auto\") {\n    return tools;\n  }\n\n  if (value instanceof Tool) {\n    const tool = tools.find((tool) => tool === value);\n    if (!tool) {\n      throw new ValueError(`Invalid tool choice provided! Tool was not found.`);\n    }\n    return [tool];\n  }\n\n  throw new ValueError(`Invalid tool choice provided (${value})!`);\n}\n"]}